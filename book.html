<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookMap â€” ë¶ë§µ ë¦¬ìŠ¤íŠ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <header class="bg-blue-600 text-white shadow">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold">ğŸ“š BookMap</h1>
      <nav class="flex gap-4">
        <a href="index.html" class="hover:underline">í™ˆ</a>
        <a href="add.html" class="hover:underline">ë„ì„œ ë“±ë¡</a>
        <a href="book.html" class="hover:underline font-bold">ë¶ë§µ ë¦¬ìŠ¤íŠ¸</a>
        <a href="map.html" class="hover:underline">ë¶ë§µ ë³´ê¸°</a>
      </nav>
    </div>
  </header>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <main class="max-w-6xl mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4">ğŸ“– ë¶ë§µ ë¦¬ìŠ¤íŠ¸</h2>

    <!-- í•„í„° -->
    <div class="bg-white rounded-xl shadow p-4 mb-6">
      <h3 class="font-semibold mb-2">í•„í„°</h3>
      <div>
        <p class="font-medium text-gray-700">ì¹´í…Œê³ ë¦¬</p>
        <div id="filter-category" class="flex flex-wrap gap-2 mb-3"></div>

        <p class="font-medium text-gray-700">ë‹¨ê³„</p>
        <div id="filter-level" class="flex flex-wrap gap-2 mb-3"></div>

        <p class="font-medium text-gray-700">ë„ì„œêµ¬ë¶„</p>
        <div id="filter-division" class="flex flex-wrap gap-2"></div>
      </div>
    </div>

    <!-- ë¡œë”© ë©”ì‹œì§€ -->
    <div id="loading" class="text-center text-gray-600 my-6">
      ğŸ“š ë„ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¡œë”©ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
    </div>

    <!-- ë„ì„œ ë¦¬ìŠ¤íŠ¸ -->
    <div id="book-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 hidden"></div>
  </main>

  <script>
    let booksData = [];
    let activeFilters = { category: [], level: [], division: [] };

    // ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
    function createFilterButtons(values, containerId, type) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      values.forEach(val => {
        const btn = document.createElement("button");
        btn.textContent = val;
        btn.className = "px-3 py-1 rounded-full border text-sm hover:bg-blue-100";
        btn.onclick = () => {
          if (activeFilters[type].includes(val)) {
            activeFilters[type] = activeFilters[type].filter(v => v !== val);
            btn.classList.remove("bg-blue-500","text-white");
          } else {
            activeFilters[type].push(val);
            btn.classList.add("bg-blue-500","text-white");
          }
          renderBooks();
        };
        container.appendChild(btn);
      });
    }

    // í•„í„° ë°˜ì˜ëœ ì±… ë Œë”ë§
    function renderBooks() {
      const list = document.getElementById("book-list");
      list.innerHTML = "";

      let filtered = booksData.filter(book => {
        const catOk = activeFilters.category.length === 0 || 
                      activeFilters.category.some(c => book.category?.includes(c));
        const levelOk = activeFilters.level.length === 0 || 
                        activeFilters.level.includes(book.level);
        const divOk = activeFilters.division.length === 0 || 
                      activeFilters.division.includes(book.division);
        return catOk && levelOk && divOk;
      });

      if (filtered.length === 0) {
        list.innerHTML = `<p class="col-span-3 text-center text-gray-500">ì¡°ê±´ì— ë§ëŠ” ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
        return;
      }

      filtered.forEach(book => {
        const card = document.createElement("div");
        card.className = "bg-white shadow rounded-xl p-4";
        card.innerHTML = `
          <img src="${book.image}" alt="${book.title}" class="w-full h-48 object-cover rounded">
          <h3 class="font-bold mt-2">${book.title}</h3>
          <p class="text-sm text-gray-600">${book.author} | ${book.publisher}</p>
          <p class="mt-2 text-gray-700 text-sm">${book.reason}</p>
          <a href="book-detail.html?id=${book.id}" class="text-blue-600 hover:underline">ìƒì„¸ë³´ê¸° â†’</a>
        `;
        list.appendChild(card);
      });
    }

    // ë°ì´í„° ë¡œë”©
    fetch("books.json")
      .then(res => res.json())
      .then(data => {
        booksData = data;

        // ë¡œë”© ë©”ì‹œì§€ ìˆ¨ê¸°ê³  ë¦¬ìŠ¤íŠ¸ ë³´ì´ê¸°
        document.getElementById("loading").style.display = "none";
        document.getElementById("book-list").classList.remove("hidden");

        // í•„í„° ë²„íŠ¼ ìƒì„±
        const categories = [...new Set(data.flatMap(b => b.category?.split(",").map(c => c.trim()) || []))];
        const levels = [...new Set(data.map(b => b.level).filter(Boolean))];
        const divisions = [...new Set(data.map(b => b.division).filter(Boolean))];

        createFilterButtons(categories, "filter-category", "category");
        createFilterButtons(levels, "filter-level", "level");
        createFilterButtons(divisions, "filter-division", "division");

        // ì´ˆê¸° ë Œë”ë§
        renderBooks();
      });
  </script>
</body>
</html>
