<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“– BookMap â€” ë„ì„œ ë¦¬ìŠ¤íŠ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <header class="bg-blue-600 text-white shadow">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold">ğŸ“š BookMap</h1>
      <nav class="flex gap-6 text-sm">
        <a href="index.html" class="hover:underline">í™ˆ</a>
        <a href="form.html" class="hover:underline">ë„ì„œ ë“±ë¡</a>
        <a href="book.html" class="hover:underline">ë¶ë§µ ë¦¬ìŠ¤íŠ¸</a>
        <a href="map.html" class="hover:underline">ë¶ë§µ ë³´ê¸°</a>
      </nav>
    </div>
  </header>

  <!-- í•„í„° UI -->
  <section class="max-w-6xl mx-auto px-6 py-6">
    <h2 class="text-xl font-bold mb-4">ğŸ” í•„í„°</h2>

    <!-- ê°€ë¡œ 5ì—´ ì •ë ¬ -->
    <div class="grid grid-cols-5 gap-4 text-sm">
      <!-- ì¹´í…Œê³ ë¦¬ -->
      <div>
        <h3 class="font-semibold mb-2">ì¹´í…Œê³ ë¦¬</h3>
        <div id="filter-category" class="flex flex-wrap gap-2"></div>
      </div>

      <!-- ë‹¨ê³„ -->
      <div>
        <h3 class="font-semibold mb-2">ë‹¨ê³„</h3>
        <div id="filter-level" class="flex flex-wrap gap-2"></div>
      </div>

      <!-- ë„ì„œêµ¬ë¶„ -->
      <div>
        <h3 class="font-semibold mb-2">ë„ì„œêµ¬ë¶„</h3>
        <div id="filter-division" class="flex flex-wrap gap-2"></div>
      </div>

      <!-- ì €ì -->
      <div>
        <h3 class="font-semibold mb-2">ì €ì</h3>
        <div id="filter-author" class="flex flex-wrap gap-2"></div>
      </div>

      <!-- ì£¼ì œ -->
      <div>
        <h3 class="font-semibold mb-2">ì£¼ì œ</h3>
        <div id="filter-subject" class="flex flex-wrap gap-2"></div>
      </div>
    </div>
  </section>

  <!-- ë„ì„œ ë¦¬ìŠ¤íŠ¸ -->
  <main class="max-w-6xl mx-auto px-6 pb-10">
    <div id="loading" class="text-center text-gray-500">ë„ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¡œë”©ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
    <div id="bookList" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 mt-6 hidden"></div>
  </main>

  <script>
    let books = [];
    let activeFilters = { category: [], level: [], division: [], author: [], subject: [] };

    async function loadBooks() {
      try {
        const res = await fetch("books.json");
        books = await res.json();
        renderFilters();
        renderBooks();
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("bookList").classList.remove("hidden");
      } catch (err) {
        console.error("ë„ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", err);
        document.getElementById("loading").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    }

    // âœ… í•„í„° ë²„íŠ¼ ìƒì„±
    function renderFilters() {
      const categories = new Set();
      const levels = new Set();
      const divisions = new Set();
      const authors = new Set();
      const subjects = new Set();

      books.forEach(b => {
        if (b.category) b.category.split(",").map(x => categories.add(x.trim()));
        if (b.level) levels.add(b.level.trim());
        if (b.division) divisions.add(b.division.trim());
        if (b.author) authors.add(b.author.trim());
        if (b.subject) {
          if (Array.isArray(b.subject)) {
            b.subject.forEach(s => subjects.add(s.trim()));
          } else {
            b.subject.split(",").map(x => subjects.add(x.trim()));
          }
        }
      });

      makeFilterButtons("filter-category", [...categories], "category");
      makeFilterButtons("filter-level", [...levels], "level");
      makeFilterButtons("filter-division", [...divisions], "division");
      makeFilterButtons("filter-author", [...authors], "author");
      makeFilterButtons("filter-subject", [...subjects], "subject");
    }

    function makeFilterButtons(containerId, items, type) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      items.forEach(item => {
        const btn = document.createElement("button");
        btn.innerText = item;
        btn.className = "px-3 py-1 rounded-full border text-gray-700 hover:bg-blue-100";
        btn.addEventListener("click", () => toggleFilter(type, item, btn));
        container.appendChild(btn);
      });
    }

    function toggleFilter(type, value, btn) {
      const idx = activeFilters[type].indexOf(value);
      if (idx === -1) {
        activeFilters[type].push(value);
        btn.classList.add("bg-blue-600", "text-white");
      } else {
        activeFilters[type].splice(idx, 1);
        btn.classList.remove("bg-blue-600", "text-white");
      }
      renderBooks();
    }

    // âœ… í•„í„°ë§ ì ìš©ëœ ë„ì„œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    function renderBooks() {
      const list = document.getElementById("bookList");
      list.innerHTML = "";

      const filtered = books.filter(b => {
        return (
          (activeFilters.category.length === 0 || activeFilters.category.some(f => b.category?.includes(f))) &&
          (activeFilters.level.length === 0 || activeFilters.level.includes(b.level)) &&
          (activeFilters.division.length === 0 || activeFilters.division.includes(b.division)) &&
          (activeFilters.author.length === 0 || activeFilters.author.includes(b.author)) &&
          (activeFilters.subject.length === 0 || (Array.isArray(b.subject) ? b.subject.some(s => activeFilters.subject.includes(s)) : activeFilters.subject.some(f => b.subject?.includes(f))))
        );
      });

      filtered.forEach(b => {
        const card = document.createElement("a");
        card.href = `book-detail.html?id=${b.id}`;
        card.className = "block bg-white rounded-lg shadow hover:shadow-lg transition p-4";

        card.innerHTML = `
          <img src="${b.image}" alt="${b.title}" class="w-full h-48 object-cover rounded mb-3">
          <h3 class="text-lg font-bold mb-1">${b.title}</h3>
          <p class="text-sm text-gray-600 mb-1">ì €ì: ${b.author}</p>
          <p class="text-sm text-gray-500">${b.publisher || ""}</p>
          <div class="flex flex-wrap gap-2 mt-2 text-xs">
            <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full">${b.category || ""}</span>
            <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full">${b.level || ""}</span>
            <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full">${b.division || ""}</span>
          </div>
        `;
        list.appendChild(card);
      });

      if (filtered.length === 0) {
        list.innerHTML = `<p class="col-span-3 text-center text-gray-500">ì¡°ê±´ì— ë§ëŠ” ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
      }
    }

    loadBooks();
  </script>
</body>
</html>
