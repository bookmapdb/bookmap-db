<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookMap — 북맵 리스트</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- 상단 네비게이션 -->
  <header class="bg-blue-600 text-white shadow">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold">📚 BookMap</h1>
      <nav class="flex gap-4">
        <a href="index.html" class="hover:underline">홈</a>
        <a href="add.html" class="hover:underline">도서 등록</a>
        <a href="book.html" class="hover:underline font-bold">북맵 리스트</a>
        <a href="map.html" class="hover:underline">북맵 보기</a>
      </nav>
    </div>
  </header>

  <!-- 메인 콘텐츠 -->
  <main class="max-w-6xl mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4">📖 북맵 리스트</h2>

    <!-- 필터 -->
    <div class="bg-white rounded-xl shadow p-4 mb-6">
      <h3 class="font-semibold mb-2">필터</h3>
      <div>
        <p class="font-medium text-gray-700">카테고리</p>
        <div id="filter-category" class="flex flex-wrap gap-2 mb-3"></div>

        <p class="font-medium text-gray-700">단계</p>
        <div id="filter-level" class="flex flex-wrap gap-2 mb-3"></div>

        <p class="font-medium text-gray-700">도서구분</p>
        <div id="filter-division" class="flex flex-wrap gap-2"></div>
      </div>
    </div>

    <!-- 로딩 메시지 -->
    <div id="loading" class="text-center text-gray-600 my-6">
      📚 도서 리스트를 로딩중입니다. 잠시만 기다려주세요.
    </div>

    <!-- 도서 리스트 -->
    <div id="book-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 hidden"></div>
  </main>

  <script>
    let booksData = [];
    let activeFilters = { category: [], level: [], division: [] };

    // 버튼 생성 함수
    function createFilterButtons(values, containerId, type) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      values.forEach(val => {
        const btn = document.createElement("button");
        btn.textContent = val;
        btn.className = "px-3 py-1 rounded-full border text-sm hover:bg-blue-100";
        btn.onclick = () => {
          if (activeFilters[type].includes(val)) {
            activeFilters[type] = activeFilters[type].filter(v => v !== val);
            btn.classList.remove("bg-blue-500","text-white");
          } else {
            activeFilters[type].push(val);
            btn.classList.add("bg-blue-500","text-white");
          }
          renderBooks();
        };
        container.appendChild(btn);
      });
    }

    // 필터 반영된 책 렌더링
    function renderBooks() {
      const list = document.getElementById("book-list");
      list.innerHTML = "";

      let filtered = booksData.filter(book => {
        const catOk = activeFilters.category.length === 0 || 
                      activeFilters.category.some(c => book.category?.includes(c));
        const levelOk = activeFilters.level.length === 0 || 
                        activeFilters.level.includes(book.level);
        const divOk = activeFilters.division.length === 0 || 
                      activeFilters.division.includes(book.division);
        return catOk && levelOk && divOk;
      });

      if (filtered.length === 0) {
        list.innerHTML = `<p class="col-span-3 text-center text-gray-500">조건에 맞는 도서가 없습니다.</p>`;
        return;
      }

      filtered.forEach(book => {
        const card = document.createElement("div");
        card.className = "bg-white shadow rounded-xl p-4";
        card.innerHTML = `
          <img src="${book.image}" alt="${book.title}" class="w-full h-48 object-cover rounded">
          <h3 class="font-bold mt-2">${book.title}</h3>
          <p class="text-sm text-gray-600">${book.author} | ${book.publisher}</p>
          <p class="mt-2 text-gray-700 text-sm">${book.reason}</p>
          <a href="book-detail.html?id=${book.id}" class="text-blue-600 hover:underline">상세보기 →</a>
        `;
        list.appendChild(card);
      });
    }

    // 데이터 로딩
    fetch("books.json")
      .then(res => res.json())
      .then(data => {
        booksData = data;

        // 로딩 메시지 숨기고 리스트 보이기
        document.getElementById("loading").style.display = "none";
        document.getElementById("book-list").classList.remove("hidden");

        // 필터 버튼 생성
        const categories = [...new Set(data.flatMap(b => b.category?.split(",").map(c => c.trim()) || []))];
        const levels = [...new Set(data.map(b => b.level).filter(Boolean))];
        const divisions = [...new Set(data.map(b => b.division).filter(Boolean))];

        createFilterButtons(categories, "filter-category", "category");
        createFilterButtons(levels, "filter-level", "level");
        createFilterButtons(divisions, "filter-division", "division");

        // 초기 렌더링
        renderBooks();
      });
  </script>
</body>
</html>
