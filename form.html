<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookMap â€” ë„ì„œ ë“±ë¡</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <header class="bg-blue-600 text-white shadow">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold cursor-pointer" onclick="location.href='index.html'">ğŸ“š BookMap</h1>
      <nav class="flex gap-6">
        <a href="index.html" class="hover:underline">í™ˆ</a>
        <a href="form.html" class="hover:underline font-semibold">ë„ì„œ ë“±ë¡</a>
        <a href="book.html" class="hover:underline">ë¶ë§µ ë¦¬ìŠ¤íŠ¸</a>
        <a href="map.html" class="hover:underline">ë¶ë§µ ê´€ê³„ë„</a>
      </nav>
    </div>
  </header>

  <!-- ë„ì„œ ë“±ë¡ í¼ -->
  <main class="max-w-3xl mx-auto px-6 py-12">
    <h2 class="text-2xl font-bold mb-6">ğŸ“– ìƒˆ ë„ì„œ ë“±ë¡</h2>
    
    <!-- êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ ì•ˆë‚´ -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-green-800">êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ ì¤‘</h3>
          <div class="mt-2 text-sm text-green-700">
            <p>ë“±ë¡í•œ ë„ì„œëŠ” êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ìë™ìœ¼ë¡œ ì €ì¥ë˜ë©°, ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶ë§µ ë¦¬ìŠ¤íŠ¸ì— ë°˜ì˜ë©ë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </div>

    <form id="bookForm" class="space-y-6">
      <!-- ê¸°ë³¸ ì •ë³´ -->
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“š ê¸°ë³¸ ì •ë³´</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">ë„ì„œëª… *</label>
            <input type="text" name="title" placeholder="ë„ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš”" 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ì €ì *</label>
            <input type="text" name="author" placeholder="ì €ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ì¶œíŒì‚¬</label>
            <input type="text" name="publisher" placeholder="ì¶œíŒì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>
      </div>

      <!-- ë¶„ë¥˜ ì •ë³´ -->
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ·ï¸ ë¶„ë¥˜ ì •ë³´</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ëŒ€ì£¼ì œ (theme)</label>
            <input type="text" name="theme" placeholder="ì˜ˆ: ì² í•™, ë¬¸í•™, ê°œë°œ" 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬</label>
            <input type="text" name="category" placeholder="ì˜ˆ: ì†Œì„¤, í•œêµ­ë¬¸í•™ (ì‰¼í‘œë¡œ êµ¬ë¶„)" 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ë„ì„œêµ¬ë¶„</label>
            <select name="division" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="êµ­ë‚´ì„œ">êµ­ë‚´ì„œ</option>
              <option value="ë²ˆì—­ì„œ">ë²ˆì—­ì„œ</option>
              <option value="ì›ì„œ">ì›ì„œ</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ë‚œì´ë„</label>
            <select name="level" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="ì…ë¬¸">ì…ë¬¸</option>
              <option value="ì´ˆê¸‰">ì´ˆê¸‰</option>
              <option value="ì¤‘ê¸‰">ì¤‘ê¸‰</option>
              <option value="ê³ ê¸‰">ê³ ê¸‰</option>
              <option value="ì „ë¬¸">ì „ë¬¸</option>
            </select>
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">ì†Œì£¼ì œ (subject)</label>
            <input type="text" name="subject" placeholder="ì˜ˆ: ì£½ìŒ, ë„ì„œê´€, ê³µì • (ì‰¼í‘œë¡œ êµ¬ë¶„)" 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>
      </div>

      <!-- ì›ì„œ ì •ë³´ (ì„ íƒì‚¬í•­) -->
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸŒ ì›ì„œ ì •ë³´ (ë²ˆì—­ì„œì¸ ê²½ìš°)</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ì›ì„œ ì œëª©</label>
            <input type="text" name="original_title" placeholder="Original Title" 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ì›ì„œ êµ¬ë§¤ ë§í¬</label>
            <input type="url" name="original_buy_link" placeholder="https://amazon.com/..." 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>
      </div>

      <!-- ì¶”ê°€ ì •ë³´ -->
      <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">ğŸ“‹ ì¶”ê°€ ì •ë³´</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">êµ¬ë§¤ ë§í¬</label>
            <input type="url" name="buy_link" placeholder="https://www.aladin.co.kr/..." 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¯¸ì§€ URL</label>
            <input type="url" name="image" placeholder="https://image.aladin.co.kr/..." 
                   class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ë„ì„œ ì„¤ëª…</label>
            <textarea name="description" rows="4" placeholder="ë„ì„œì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" 
                      class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ì¶”ì²œ ì´ìœ </label>
            <textarea name="reason" rows="3" placeholder="ì´ ë„ì„œë¥¼ ì¶”ì²œí•˜ëŠ” ì´ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                      class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
        </div>
      </div>

      <!-- ë²„íŠ¼ -->
      <div class="flex gap-4">
        <button type="submit" 
                class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-medium transition-colors">
          <span class="button-text">ğŸ“š ë“±ë¡í•˜ê¸°</span>
          <span class="loading-text hidden">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            ë“±ë¡ ì¤‘...
          </span>
        </button>
        <button type="reset" 
                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
          ì´ˆê¸°í™”
        </button>
      </div>
    </form>

    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
    <div id="statusMessage" class="mt-6 p-4 rounded-lg hidden"></div>
  </main>

  <script>
    const form = document.getElementById("bookForm");
    const statusMessage = document.getElementById("statusMessage");
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbywJOW4dOlmDrzood3ka_jizri4K7sFqTJDPG8ibnmDrxXZgFWrFnjMEv38C5pCtjp_/exec";

    // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
    function showMessage(message, type = 'success') {
      const bgColor = type === 'success' ? 'bg-green-50 border-green-200 text-green-800' : 
                      type === 'error' ? 'bg-red-50 border-red-200 text-red-800' : 
                      'bg-blue-50 border-blue-200 text-blue-800';
      
      statusMessage.className = `mt-6 p-4 rounded-lg border ${bgColor}`;
      statusMessage.innerHTML = message;
      statusMessage.classList.remove('hidden');
      
      // ì„±ê³µ ì‹œ 5ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
      if (type === 'success') {
        setTimeout(() => {
          statusMessage.classList.add('hidden');
        }, 5000);
      }
    }

    // ë¡œë”© ìƒíƒœ í† ê¸€
    function toggleLoading(isLoading) {
      const submitBtn = form.querySelector('button[type="submit"]');
      const buttonText = submitBtn.querySelector('.button-text');
      const loadingText = submitBtn.querySelector('.loading-text');
      
      if (isLoading) {
        buttonText.classList.add('hidden');
        loadingText.classList.remove('hidden');
        submitBtn.disabled = true;
        submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
      } else {
        buttonText.classList.remove('hidden');
        loadingText.classList.add('hidden');
        submitBtn.disabled = false;
        submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
      }
    }

    // í¼ ì œì¶œ ì²˜ë¦¬
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      try {
        toggleLoading(true);
        showMessage('ğŸ“¤ ë„ì„œ ë“±ë¡ ì¤‘ì…ë‹ˆë‹¤...', 'info');

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        
        // ë¹ˆ ê°’ë“¤ì„ ë¹ˆ ë¬¸ìì—´ë¡œ ì„¤ì •
        Object.keys(data).forEach(key => {
          if (!data[key]) {
            data[key] = "";
          }
        });

        console.log('ì „ì†¡ ë°ì´í„°:', data); // ë””ë²„ê¹…ìš©

        const response = await fetch(APPS_SCRIPT_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: new URLSearchParams({
            'postData': JSON.stringify(data)
          })
        });

        // Google Apps ScriptëŠ” í•­ìƒ 200ì„ ë°˜í™˜í•˜ë¯€ë¡œ ì‘ë‹µ ë‚´ìš©ì„ í™•ì¸
        const responseText = await response.text();
        console.log('ì‘ë‹µ:', responseText); // ë””ë²„ê¹…ìš©
        
        let result;
        try {
          result = JSON.parse(responseText);
        } catch (parseError) {
          console.log('JSON íŒŒì‹± ì‹¤íŒ¨, í…ìŠ¤íŠ¸ ì‘ë‹µ:', responseText);
          // ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ ê²ƒìœ¼ë¡œ ê°„ì£¼
          result = { success: true };
        }

        if (result.success !== false) {
          showMessage('âœ… ë„ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! 3ì´ˆ í›„ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'success');
          
          // í¼ ì´ˆê¸°í™”
          form.reset();
          
          // 3ì´ˆ í›„ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
          setTimeout(() => {
            window.location.href = "book.html";
          }, 3000);
          
        } else {
          throw new Error(result.error || 'ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
        
      } catch (error) {
        console.error('ë“±ë¡ ì˜¤ë¥˜:', error);
        showMessage(`âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
      } finally {
        toggleLoading(false);
      }
    });

    // ì‹¤ì‹œê°„ í¼ ê²€ì¦
    form.addEventListener('input', (e) => {
      const target = e.target;
      if (target.required && !target.value.trim()) {
        target.classList.add('border-red-300', 'focus:border-red-500', 'focus:ring-red-500');
        target.classList.remove('border-gray-300', 'focus:border-blue-500', 'focus:ring-blue-500');
      } else {
        target.classList.remove('border-red-300', 'focus:border-red-500', 'focus:ring-red-500');
        target.classList.add('border-gray-300', 'focus:border-blue-500', 'focus:ring-blue-500');
      }
    });
  </script>
</body>
</html>
