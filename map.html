<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookMap â€” ê´€ê³„ë„ ë³´ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/cytoscape@3.28.0/dist/cytoscape.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <header class="bg-blue-600 text-white shadow">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold">ğŸ“š BookMap â€” ê´€ê³„ë„</h1>
      <nav class="flex gap-6 text-sm">
        <a href="index.html" class="hover:underline">í™ˆ</a>
        <a href="form.html" class="hover:underline">ë„ì„œ ë“±ë¡</a>
        <a href="book.html" class="hover:underline">ë¶ë§µ ë¦¬ìŠ¤íŠ¸</a>
      </nav>
    </div>
  </header>

  <!-- ë©”ì¸ -->
  <main class="max-w-6xl mx-auto px-6 py-8">
    <div id="bookMap" class="w-full h-[600px] border rounded bg-white"></div>
  </main>

  <script>
  async function loadBookMap() {
    const urlParams = new URLSearchParams(window.location.search);
    const bookId = urlParams.get("id");

    const res = await fetch("books.json"); // ğŸ“Œ ë„ì„œ ë°ì´í„°
    const books = await res.json();
    const book = books.find(b => b.id == bookId);

    if (!book) {
      document.getElementById("bookMap").innerHTML =
        `<p class="text-center text-gray-500 py-20">í•´ë‹¹ ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
      return;
    }

    // ë…¸ë“œ ë° ì—£ì§€ ì •ì˜
    const nodes = [
      { data: { id: book.id, label: book.title, type: "book" } },
      { data: { id: "cat-" + book.category, label: book.category, type: "category" } },
      { data: { id: "level-" + book.level, label: book.level, type: "level" } }
    ];
    const edges = [
      { data: { source: book.id, target: "cat-" + book.category } },
      { data: { source: book.id, target: "level-" + book.level } }
    ];

    // ê´€ë ¨ ë„ì„œ (ê°™ì€ ì¹´í…Œê³ ë¦¬/ë‹¨ê³„)
    books.forEach(b => {
      if (b.id !== book.id) {
        if (b.category === book.category) {
          nodes.push({ data: { id: b.id, label: b.title, type: "related" } });
          edges.push({ data: { source: "cat-" + b.category, target: b.id } });
        }
        if (b.level === book.level) {
          nodes.push({ data: { id: b.id, label: b.title, type: "related" } });
          edges.push({ data: { source: "level-" + b.level, target: b.id } });
        }
      }
    });

    // Cytoscape ì´ˆê¸°í™”
    cytoscape({
      container: document.getElementById("bookMap"),
      elements: { nodes, edges },
      style: [
        { selector: 'node[type="book"]', style: { 'background-color': '#3b82f6', 'label': 'data(label)', 'font-size': 12, 'color': '#fff', 'text-valign': 'center' }},
        { selector: 'node[type="category"]', style: { 'background-color': '#10b981', 'label': 'data(label)', 'shape': 'round-rectangle', 'color': '#fff', 'font-size': 11 }},
        { selector: 'node[type="level"]', style: { 'background-color': '#f59e0b', 'label': 'data(label)', 'shape': 'diamond', 'color': '#fff', 'font-size': 11 }},
        { selector: 'node[type="related"]', style: { 'background-color': '#9ca3af', 'label': 'data(label)', 'font-size': 10, 'color': '#111', 'text-wrap': 'ellipsis', 'text-max-width': 100 }},
        { selector: 'edge', style: { 'width': 2, 'line-color': '#d1d5db', 'target-arrow-shape': 'triangle', 'target-arrow-color': '#d1d5db', 'curve-style': 'bezier' }}
      ],
      layout: {
        name: 'breadthfirst',  // íŠ¸ë¦¬í˜• ë°°ì¹˜
        directed: true,
        padding: 30,
        spacingFactor: 1.2,
        animate: true
      }
    });
  }

  loadBookMap();
  </script>
</body>
</html>
